<a href="#" id = "instagram-photo-link"><img  style="
    width: 55px;
    vertical-align: bottom;
    position: relative;
    left: 11px;
" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjwhRE9DVFlQRSBzdmcgIFBVQkxJQyAnLS8vVzNDLy9EVEQgU1ZHIDEuMC8vRU4nICAnaHR0cDovL3d3dy53My5vcmcvVFIvMjAwMS9SRUMtU1ZHLTIwMDEwOTA0L0RURC9zdmcxMC5kdGQnPjxzdmcgaGVpZ2h0PSIzMiIgc3R5bGU9Im92ZXJmbG93OnZpc2libGU7ZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCAzMiAzMiIgdmlld0JveD0iMCAwIDMyIDMyIiB3aWR0aD0iMzIiIHhtbDpzcGFjZT0icHJlc2VydmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxnPjxnIGlkPSJJbnN0YWdyYW1fMV8iPjxnIGlkPSJJbnN0YWdyYW0iPjxwYXRoIGQ9Ik0yOCwwSDRDMS44LDAsMCwxLjgsMCw0djhoMzJWNEMzMiwxLjgsMzAuMiwwLDI4LDB6IiBpZD0iSGVhZCIgc3R5bGU9ImZpbGw6Izg5NUE0RDsiLz48cGF0aCBkPSJNMiwwLjZWMTJoMlYwQzMuMywwLDIuNiwwLjIsMiwwLjZ6IiBpZD0iUmVkX3g1Rl9TdHJpcGVzIiBzdHlsZT0iZmlsbDojRkYzOTM5OyIvPjxyZWN0IGhlaWdodD0iMTIiIGlkPSJZZWxsb3dfeDVGX1N0cmlwZXMiIHN0eWxlPSJmaWxsOiNGRUQwNDk7IiB3aWR0aD0iMiIgeD0iNCIvPjxyZWN0IGhlaWdodD0iMTIiIGlkPSJHcmVlbl94NUZfU3RyaXBlcyIgc3R5bGU9ImZpbGw6IzEwREQ3NjsiIHdpZHRoPSIyIiB4PSI2Ii8+PHJlY3QgaGVpZ2h0PSIxMiIgaWQ9IkJsdWVfeDVGX1N0cmlwZXMiIHN0eWxlPSJmaWxsOiM1RkNDRkY7IiB3aWR0aD0iMiIgeD0iOCIvPjxjaXJjbGUgY3g9IjI2IiBjeT0iNiIgaWQ9IkxlbnNfMV8iIHI9IjMiIHN0eWxlPSJmaWxsOiMxNjI4Mzg7Ii8+PGNpcmNsZSBjeD0iMjYiIGN5PSI2IiBpZD0iTGVuc194NUZfT3V0ZXIiIHI9IjEuNSIgc3R5bGU9ImZpbGw6IzJDNDM1NjsiLz48Y2lyY2xlIGN4PSIyNiIgY3k9IjYiIGlkPSJMZW5zX3g1Rl9JbnNpZGUiIHI9IjAuNSIgc3R5bGU9ImZpbGw6IzQ3NjM3QTsiLz48cGF0aCBkPSJNMCwxMnYxNmMwLDIuMiwxLjgsNCw0LDRoMjRjMi4yLDAsNC0xLjgsNC00VjEySDB6IiBpZD0iQm9keSIgc3R5bGU9ImZpbGw6I0U1RTBEQzsiLz48ZyBpZD0iU2hhZG93Ij48cG9seWdvbiBwb2ludHM9IjI0LjcsMTIgMjIuNCw5LjYgMjIuNCwxMiAiIHN0eWxlPSJmaWxsOiM3NTQ4M0Q7Ii8+PHBhdGggZD0iTTIwLDEyTDkuNiwyMi40bDkuNiw5LjZIMjhjMi4yLDAsNC0xLjgsNC00di04LjdMMjQuNywxMkgyMHoiIHN0eWxlPSJmaWxsOiNEMENCQzU7Ii8+PC9nPjxjaXJjbGUgY3g9IjE2IiBjeT0iMTYiIGlkPSJMZW5zIiByPSI5IiBzdHlsZT0iZmlsbDojRENEN0QzOyIvPjxjaXJjbGUgY3g9IjE2IiBjeT0iMTYiIGlkPSJJbnNpZGVfeDVGX0xlbnMiIHI9IjciIHN0eWxlPSJmaWxsOiMxNjI4Mzg7Ii8+PGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgaWQ9Il94MzJfbmRfSW5uZXJfQ2lyY2xlIiByPSI0IiBzdHlsZT0iZmlsbDojMkM0MzU2OyIvPjxjaXJjbGUgY3g9IjE2IiBjeT0iMTYiIGlkPSJNaWRkbGVfQ2lyY2xlIiByPSIyIiBzdHlsZT0iZmlsbDojMTYyODM4OyIvPjxjaXJjbGUgY3g9IjE4LjUiIGN5PSIxMy41IiBpZD0iUmVmbGVjdGlvbiIgcj0iMS41IiBzdHlsZT0iZmlsbDojNDc2MzdBOyIvPjwvZz48L2c+PC9nPjwvc3ZnPg=="/>
	</a>

<script type="text/javascript">
insta_photo_counter = 0;

function openInstagramRedirectWindow() {
 	var child = window.open("{{{url('/instagram')}}}", "_blank","height=400, width=600, status=yes, toolbar=no, menubar=no, location=no");
 	
 	timer = setInterval(function(){
 		if (child.closed) {
	        
	        insta_userid = insta_token = '';
	        try {
	        	insta_token = child.document.getElementById("insta_token").value;
 				insta_userid = child.document.getElementById("insta_user_id").value;
 				
	        } catch (err) {
	        	insta_photo_counter = 0;
	        	toastr.error('{{{trans('app.some_error')}}}');
	        }
	        clearInterval(timer);

	        if(insta_userid == ' ' || insta_token == '' ) {
	        	toastr.error('{{{trans('app.some_error')}}}');
	        	insta_photo_counter = 0;
	        } else {

	        	$(".insta-photo-loader").show();

	        	$.post('{{{url('instagram/get-photos')}}}',
	        		{_token:"{{{csrf_token()}}}", token:insta_token, user_id:insta_userid},
	        	function(res){

	        		if(res.status == 'success') {	        			

				        for(var i = 0; i < res.photos.length; i++) {
				        	insta_photo_counter++;
				        	var html = '<div class="img-container" data-photo-id="'+res.photos[i].photo_id+'" data-checked="false"><img src="'+res.photos[i].photo_source+'"><i class="fa fa-check-circle fb-photo-check"></i><div class="select-curtain"></div></div>';
				        	$("#instagram-photo-upload-modal > div > .modal-content > .modal-body > .body-down-div")
				        	.prepend(html);

				        }


	        		} else if (res.status == 'no_photo') {
	        			insta_photo_counter = 0;
				  		toastr.error('{{{trans('app.no_photos')}}}');
	        		} else {
	        			insta_photo_counter = 0;
	        			toastr.error('{{{trans('app.some_error')}}}');
	        		}
	        		$(".insta-photo-loader").hide();
				  	$('#insta-photos-counter').text(insta_photo_counter);
	        	});
	        }

	    }
 	}, 500);
 }


$("#instagram-photo-link").on('click', function(){

	insta_photo_counter = 0;
	instagram_import_photos = [];
	var img_container = $(".body-down-div").find('.img-container');
	img_container.each(function(index){
		$(this).remove();
	});
	openInstagramRedirectWindow();

	//$("#photoModal").modal('hide');
	$("#instagram-photo-upload-modal").modal('show');
});
</script>

